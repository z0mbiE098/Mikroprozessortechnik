


ARM Macro Assembler    Page 1 


    1 00000000         ;*******************************************************
                       *************
    2 00000000         ;* htw saar - Fakultaet fuer Ingenieurwissenschaften    
                       *
    3 00000000         ;* Labor fuer Eingebettete Systeme         *
    4 00000000         ;* Mikroprozessortechnik           *
    5 00000000         ;*******************************************************
                       *************
    6 00000000         ;* Assembler_Startup.S:            *
    7 00000000         ;* Programmrumpf fuer Assembler-Programme mit dem Keil  
                         *
    8 00000000         ;* Entwicklungsprogramm uVision fuer ARM-Mikrocontroller
                          *
    9 00000000         ;*******************************************************
                       *************
   10 00000000         ;* Aufgabe-Nr.:          *                      *
   11 00000000         ;*                 *             *
   12 00000000         ;*******************************************************
                       *************
   13 00000000         ;* Gruppen-Nr.:    *          *
   14 00000000         ;*                 *          *
   15 00000000         ;*******************************************************
                       *************
   16 00000000         ;* Name / Matrikel-Nr.:  *          *
   17 00000000         ;*       *          *
   18 00000000         ;*       *          *
   19 00000000         ;*******************************************************
                       *************
   20 00000000         ;* Abgabedatum:          *                     *
   21 00000000         ;*       *          *
   22 00000000         ;*******************************************************
                       *************
   23 00000000         
   24 00000000         ;*******************************************************
                       *************
   25 00000000         ;* Daten-Bereich bzw. Daten-Speicher                 *
   26 00000000         ;*******************************************************
                       *************
   27 00000000                 AREA             Daten, DATA, READWRITE
   28 00000000         Datenanfang
   29 00000000         
   30 00000000 00000400 
                       RAM_Size
                               EQU              0x400       ; 1024 Byte Stack-G
                                                            röße
   31 00000000         
   32 00000000 00000400 
                       Top_Stack
                               EQU              Datenanfang+RAM_Size
   33 00000000 00000400 
                       Datenende
                               EQU              Top_Stack
   34 00000000         
   35 00000000         ;*******************************************************
                       *************
   36 00000000         ;* Programm-Bereich bzw. Programm-Speicher       *
   37 00000000         ;*******************************************************
                       *************
   38 00000000         



ARM Macro Assembler    Page 2 


   39 00000000                 AREA             Programm, CODE, READONLY
   40 00000000                 ARM
   41 00000000 E321F010 
                       Reset_Handler
                               MSR              CPSR_c, #0x10 ; User Mode
   42 00000004 E59FD180        LDR              SP, =Top_Stack
   43 00000008         
   44 00000008         ;*******************************************************
                       *************
   45 00000008         ;* Hier das eigene (Haupt-)Programm einfuegen        *
   46 00000008         ;*******************************************************
                       *************
   47 00000008         
   48 00000008 E59F0180        LDR              R0, =String ;
   49 0000000C EB00003C        BL               Berechnung  ;
   50 00000010         
   51 00000010         ;LDR R0, =String
   52 00000010         ;BL AtoI
   53 00000010         
   54 00000010         ;LDR R0, =X
   55 00000010         ;LDR R0, [R0]
   56 00000010         ;BL Formel
   57 00000010         
   58 00000010         ;LDR R0, =Number
   59 00000010         ;LDR R0, [R0]
   60 00000010         ;BL uItoBCD
   61 00000010         ;*******************************************************
                       *************
   62 00000010         ;* Ende des eigenen (Haupt-)Programms                   
                                   *
   63 00000010         ;*******************************************************
                       *************
   64 00000010         
   65 00000010 EAFFFFFE 
                       endlos  B                endlos      ;
   66 00000014         
   67 00000014         ;*******************************************************
                       *************
   68 00000014         ;* ab hier Unterprogramme                               
                                   *
   69 00000014         ;*******************************************************
                       *************
   70 00000014         
   71 00000014         
   72 00000014         ;------------------------Aufgabe 1----------------------
                       -------------
   73 00000014         AtoI
   74 00000014 E92D403E        PUSH             {R1, R2, R3, R4, R5, LR}
   75 00000018 E3A02000        MOV              R2, #0
   76 0000001C E3A03000        MOV              R3, #0
   77 00000020 E5D01000        LDRB             R1, [R0]
   78 00000024         
   79 00000024 E351002B        CMP              R1, #0x2B
   80 00000028 0A000002        BEQ              Skip_first_positive
   81 0000002C         
   82 0000002C E351002D        CMP              R1, #0x2D
   83 00000030 0A000002        BEQ              Set_Minus
   84 00000034 EA000003        B                AtoI_Loop
   85 00000038         



ARM Macro Assembler    Page 3 


   86 00000038         Skip_first_positive
   87 00000038 E2800001        ADD              R0, R0, #1
   88 0000003C EA000001        B                AtoI_Loop
   89 00000040         
   90 00000040         Set_Minus
   91 00000040 E3A03001        MOV              R3, #1
   92 00000044 E2800001        ADD              R0, R0, #1
   93 00000048         
   94 00000048         AtoI_Loop
   95 00000048 E5D01000        LDRB             R1, [R0]
   96 0000004C E3510000        CMP              R1, #0
   97 00000050 0A000005        BEQ              AtoI_EndDigits
   98 00000054         
   99 00000054 E2411030        SUB              R1, R1, #CHAR_0
  100 00000058 E1A04182        MOV              R4, R2, LSL #3
  101 0000005C E0844082        ADD              R4, R4, R2, LSL#1
  102 00000060 E0842001        ADD              R2, R4, R1
  103 00000064         
  104 00000064 E2800001        ADD              R0, R0, #1
  105 00000068 EAFFFFF6        B                AtoI_Loop
  106 0000006C         AtoI_EndDigits
  107 0000006C E3530000        CMP              R3, #0
  108 00000070 0A000000        BEQ              AtoI_Positive
  109 00000074 E2622000        RSB              R2, R2, #0
  110 00000078         
  111 00000078         AtoI_Positive
  112 00000078 E1A00002        MOV              R0, R2
  113 0000007C E8BD403E        POP              {R1, R2, R3, R4, R5, LR}
  114 00000080 E12FFF1E        BX               LR
  115 00000084         
  116 00000084         ;------------------------Aufgabe 2----------------------
                       -------------
  117 00000084         
  118 00000084         Formel
  119 00000084 E92D401E        PUSH             {R1, R2, R3, R4, LR}
  120 00000088 E1A01000        MOV              R1, R0
  121 0000008C E0020191        MUL              R2, R1, R1
  122 00000090 E3A03000        MOV              R3, #0
  123 00000094         
  124 00000094         Division_Loop
  125 00000094 E3520009        CMP              R2, #9
  126 00000098 BA000002        BLT              Division_Done
  127 0000009C         
  128 0000009C E2422009        SUB              R2, R2, #9
  129 000000A0 E2833001        ADD              R3, R3, #1
  130 000000A4 EAFFFFFA        B                Division_Loop
  131 000000A8         
  132 000000A8         Division_Done
  133 000000A8 E1A00103        MOV              R0, R3, LSL #2
  134 000000AC E8BD401E        POP{R1,          R2, R3, R4, LR}
  135 000000B0 E12FFF1E        BX               LR
  136 000000B4         
  137 000000B4         ;------------------------Aufgabe 3----------------------
                       -------------
  138 000000B4         
  139 000000B4         uItoBCD
  140 000000B4 E92D403E        PUSH             {R1, R2, R3, R4, R5, LR}
  141 000000B8 E3A01000        MOV              R1, #0
  142 000000BC E3A02000        MOV              R2, #0



ARM Macro Assembler    Page 4 


  143 000000C0         
  144 000000C0         uItoBCD_Loop
  145 000000C0 E3500000        CMP              R0, #0
  146 000000C4 0A00000B        BEQ              uItoBCD_Done
  147 000000C8 E1A03000        MOV              R3, R0
  148 000000CC E3A04000        MOV              R4, #0
  149 000000D0         
  150 000000D0         uItoBCD_Division_Loop
  151 000000D0 E353000A        CMP              R3, #10
  152 000000D4 BA000002        BLT              uItoBCD_END
  153 000000D8 E243300A        SUB              R3, R3, #10
  154 000000DC E2844001        ADD              R4, R4, #1
  155 000000E0 EAFFFFFA        B                uItoBCD_Division_Loop
  156 000000E4         
  157 000000E4         uItoBCD_END
  158 000000E4 E1A05213        MOV              R5, R3, LSL R2
  159 000000E8 E1811005        ORR              R1, R1, R5
  160 000000EC E2822004        ADD              R2, R2, #4
  161 000000F0 E1A00004        MOV              R0, R4      ; -----------
  162 000000F4 EAFFFFF1        B                uItoBCD_Loop
  163 000000F8         
  164 000000F8         uItoBCD_Done
  165 000000F8 E1A00001        MOV              R0, R1
  166 000000FC E8BD403E        POP{R1,          R2, R3, R4, R5, LR}
  167 00000100 E12FFF1E        BX               LR
  168 00000104         
  169 00000104         ;------------------------Aufgabe 4----------------------
                       -------------
  170 00000104         
  171 00000104         ; R0 (in)  = Adresse des Strings mit X (ASCII, evtl. mit
                        + / -)
  172 00000104         ; R0 (out) = Y als gepackte BCD-Zahl
  173 00000104         ; Ablauf:
  174 00000104         ;   AtoI   : String -> X (signed int)
  175 00000104         ;   Formel : X -> Y  (signed int)
  176 00000104         ;   uItoBCD: Y -> BCD(Y)
  177 00000104         Berechnung
  178 00000104 E52DE004        PUSH             {LR}        ; eigenen Rücksprun
                                                            g sichern
  179 00000108         
  180 00000108         ;R0 = &String_X
  181 00000108 EBFFFFC1        BL               AtoI        ; R0 = X (signed In
                                                            teger)
  182 0000010C EB000002        BL               Formel_2    ; R0 = Y = 4*X^2/9
  183 00000110 EB000007        BL               uItoBCD_2   ; R0 = Y als BCD
  184 00000114         
  185 00000114 E49DE004        POP              {LR}
  186 00000118 E12FFF1E        BX               LR
  187 0000011C         
  188 0000011C         ;------------------------------Aufgabe 2 mit magic numbe
                       rs-----------
  189 0000011C         
  190 0000011C         Formel_2
  191 0000011C E59F1070        LDR              R1, =DIV_9
  192 00000120 E0020090        MUL              R2, R0, R0  ; X^2 in R2 abgespe
                                                            ichert
  193 00000124 E0843192        UMULL            R3, R4, R2, R1 ; x^2 wird mit M
                                                            agicNumber multipli
                                                            ziert, UMULL anstel



ARM Macro Assembler    Page 5 


                                                            le von SMULL, da R2
                                                             immer positiv ist,
                                                             da R2 = R0^2 
  194 00000128 E1A030A4        MOV              R3, R4, LSR #1 ; Rechts-Shift u
                                                            m n = 1, s. Skript 
                                                            S. 96 Tabelle 18, d
                                                            amit Ergebnis nicht
                                                             mehr als LONG vorl
                                                            iegt, herunterskali
                                                            eren durch Rechts-S
                                                            hift nach mul mit M
                                                            agicNumber -> LSR #
                                                            1 == * 2^-n
  195 0000012C E1A00103        MOV              R0, R3, LSL #2 ; Term wird mit 
                                                            2^2 = 4 multiplizie
                                                            rt und in R0 gespei
                                                            chert
  196 00000130 E12FFF1E        BX               LR
  197 00000134         
  198 00000134         
  199 00000134         ;------------------------Aufgabe 3 mit magic numbers----
                       -------------
  200 00000134         
  201 00000134         uItoBCD_2
  202 00000134 E92D41FE        PUSH             {R1-R8, LR}
  203 00000138 E3A01000        MOV              R1, #0      ; BCD-Ergebnis
  204 0000013C E3A02000        MOV              R2, #0      ; shift = 0
  205 00000140 E59F5050        LDR              R5, =DIV_10
  206 00000144 E3A0600A        MOV              R6, #10
  207 00000148         
  208 00000148         uItoBCD_Loop_2
  209 00000148 E3500000        CMP              R0, #0
  210 0000014C 0A000008        BEQ              uItoBCD_Done_2
  211 00000150         
  212 00000150         
  213 00000150 E0873590        UMULL            R3, R7, R0, R5 ; 
  214 00000154 E1A031A7        MOV              R3, R7, LSR#3 ; q = R0 / 10
  215 00000158         
  216 00000158         
  217 00000158 E0040693        MUL              R4, R3, R6  ; R4 = q * 10
  218 0000015C E0404004        SUB              R4, R0, R4  ; r = R0 - q * 10 ,
                                                             sprich modulo
  219 00000160         
  220 00000160 E1A08214        MOV              R8, R4, LSL R2
  221 00000164 E0811008        ADD              R1, R1, R8
  222 00000168         
  223 00000168         
  224 00000168 E1A00003        MOV              R0, R3
  225 0000016C E2822004        ADD              R2, R2, #4
  226 00000170         
  227 00000170 EAFFFFF4        B                uItoBCD_Loop_2
  228 00000174         
  229 00000174         uItoBCD_Done_2
  230 00000174 E1A00001        MOV              R0, R1      ; Rückgabe: BCD
  231 00000178 E8BD41FE        POP              {R1-R8, LR}
  232 0000017C E12FFF1E        BX               LR
  233 00000180         
  234 00000180         ;*******************************************************
                       *************



ARM Macro Assembler    Page 6 


  235 00000180         ;* Konstanten im CODE-Bereich                           
                                   *
  236 00000180         ;*******************************************************
                       *************
  237 00000180         
  238 00000180 31 30 30 
              00       String  DCB              "100",0
  239 00000184 00000030 
                       CHAR_0  EQU              0x30
  240 00000184                 ALIGN
  241 00000184 00000064 
                       X       DCD              100
  242 00000188 00000BDB 
                       Number  DCD              3035
  243 0000018C 38E38E39 
                       DIV_9   EQU              0x38E38E39  ; mit n=1
  244 0000018C CCCCCCCD 
                       DIV_10  EQU              0xCCCCCCCD  ; mit n=3
  245 0000018C         
  246 0000018C         ;*******************************************************
                       *************
  247 0000018C         ;* Ende der Programm-Quelle                             
                                   *
  248 0000018C         ;*******************************************************
                       *************
  249 0000018C                 END
              00000000 
              00000000 
              38E38E39 
              CCCCCCCD 
Command Line: --debug --xref --depend=.\assembler_startup.d -o.\assembler_start
up.o -IC:\Keil\ARM\RV31\INC -IC:\Keil\ARM\CMSIS\Include -IC:\Keil\ARM\Inc\Phili
ps --predefine="__EVAL SETA 1" --list=.\assembler_startup.lst Assembler_Startup
.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

Daten 00000000

Symbol: Daten
   Definitions
      At line 27 in file Assembler_Startup.s
   Uses
      None
Comment: Daten unused
Datenanfang 00000000

Symbol: Datenanfang
   Definitions
      At line 28 in file Assembler_Startup.s
   Uses
      At line 32 in file Assembler_Startup.s
Comment: Datenanfang used once
Datenende 00000400

Symbol: Datenende
   Definitions
      At line 33 in file Assembler_Startup.s
   Uses
      None
Comment: Datenende unused
Top_Stack 00000400

Symbol: Top_Stack
   Definitions
      At line 32 in file Assembler_Startup.s
   Uses
      At line 33 in file Assembler_Startup.s
      At line 42 in file Assembler_Startup.s

4 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

AtoI 00000014

Symbol: AtoI
   Definitions
      At line 73 in file Assembler_Startup.s
   Uses
      At line 181 in file Assembler_Startup.s
Comment: AtoI used once
AtoI_EndDigits 0000006C

Symbol: AtoI_EndDigits
   Definitions
      At line 106 in file Assembler_Startup.s
   Uses
      At line 97 in file Assembler_Startup.s
Comment: AtoI_EndDigits used once
AtoI_Loop 00000048

Symbol: AtoI_Loop
   Definitions
      At line 94 in file Assembler_Startup.s
   Uses
      At line 84 in file Assembler_Startup.s
      At line 88 in file Assembler_Startup.s
      At line 105 in file Assembler_Startup.s

AtoI_Positive 00000078

Symbol: AtoI_Positive
   Definitions
      At line 111 in file Assembler_Startup.s
   Uses
      At line 108 in file Assembler_Startup.s
Comment: AtoI_Positive used once
Berechnung 00000104

Symbol: Berechnung
   Definitions
      At line 177 in file Assembler_Startup.s
   Uses
      At line 49 in file Assembler_Startup.s
Comment: Berechnung used once
Division_Done 000000A8

Symbol: Division_Done
   Definitions
      At line 132 in file Assembler_Startup.s
   Uses
      At line 126 in file Assembler_Startup.s
Comment: Division_Done used once
Division_Loop 00000094

Symbol: Division_Loop
   Definitions
      At line 124 in file Assembler_Startup.s
   Uses
      At line 130 in file Assembler_Startup.s
Comment: Division_Loop used once
Formel 00000084



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols


Symbol: Formel
   Definitions
      At line 118 in file Assembler_Startup.s
   Uses
      None
Comment: Formel unused
Formel_2 0000011C

Symbol: Formel_2
   Definitions
      At line 190 in file Assembler_Startup.s
   Uses
      At line 182 in file Assembler_Startup.s
Comment: Formel_2 used once
Number 00000188

Symbol: Number
   Definitions
      At line 242 in file Assembler_Startup.s
   Uses
      None
Comment: Number unused
Programm 00000000

Symbol: Programm
   Definitions
      At line 39 in file Assembler_Startup.s
   Uses
      None
Comment: Programm unused
Reset_Handler 00000000

Symbol: Reset_Handler
   Definitions
      At line 41 in file Assembler_Startup.s
   Uses
      None
Comment: Reset_Handler unused
Set_Minus 00000040

Symbol: Set_Minus
   Definitions
      At line 90 in file Assembler_Startup.s
   Uses
      At line 83 in file Assembler_Startup.s
Comment: Set_Minus used once
Skip_first_positive 00000038

Symbol: Skip_first_positive
   Definitions
      At line 86 in file Assembler_Startup.s
   Uses
      At line 80 in file Assembler_Startup.s
Comment: Skip_first_positive used once
String 00000180

Symbol: String
   Definitions



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Relocatable symbols

      At line 238 in file Assembler_Startup.s
   Uses
      At line 48 in file Assembler_Startup.s
Comment: String used once
X 00000184

Symbol: X
   Definitions
      At line 241 in file Assembler_Startup.s
   Uses
      None
Comment: X unused
endlos 00000010

Symbol: endlos
   Definitions
      At line 65 in file Assembler_Startup.s
   Uses
      At line 65 in file Assembler_Startup.s
Comment: endlos used once
uItoBCD 000000B4

Symbol: uItoBCD
   Definitions
      At line 139 in file Assembler_Startup.s
   Uses
      None
Comment: uItoBCD unused
uItoBCD_2 00000134

Symbol: uItoBCD_2
   Definitions
      At line 201 in file Assembler_Startup.s
   Uses
      At line 183 in file Assembler_Startup.s
Comment: uItoBCD_2 used once
uItoBCD_Division_Loop 000000D0

Symbol: uItoBCD_Division_Loop
   Definitions
      At line 150 in file Assembler_Startup.s
   Uses
      At line 155 in file Assembler_Startup.s
Comment: uItoBCD_Division_Loop used once
uItoBCD_Done 000000F8

Symbol: uItoBCD_Done
   Definitions
      At line 164 in file Assembler_Startup.s
   Uses
      At line 146 in file Assembler_Startup.s
Comment: uItoBCD_Done used once
uItoBCD_Done_2 00000174

Symbol: uItoBCD_Done_2
   Definitions
      At line 229 in file Assembler_Startup.s
   Uses
      At line 210 in file Assembler_Startup.s



ARM Macro Assembler    Page 4 Alphabetic symbol ordering
Relocatable symbols

Comment: uItoBCD_Done_2 used once
uItoBCD_END 000000E4

Symbol: uItoBCD_END
   Definitions
      At line 157 in file Assembler_Startup.s
   Uses
      At line 152 in file Assembler_Startup.s
Comment: uItoBCD_END used once
uItoBCD_Loop 000000C0

Symbol: uItoBCD_Loop
   Definitions
      At line 144 in file Assembler_Startup.s
   Uses
      At line 162 in file Assembler_Startup.s
Comment: uItoBCD_Loop used once
uItoBCD_Loop_2 00000148

Symbol: uItoBCD_Loop_2
   Definitions
      At line 208 in file Assembler_Startup.s
   Uses
      At line 227 in file Assembler_Startup.s
Comment: uItoBCD_Loop_2 used once
25 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

CHAR_0 00000030

Symbol: CHAR_0
   Definitions
      At line 239 in file Assembler_Startup.s
   Uses
      At line 99 in file Assembler_Startup.s
Comment: CHAR_0 used once
DIV_10 CCCCCCCD

Symbol: DIV_10
   Definitions
      At line 244 in file Assembler_Startup.s
   Uses
      At line 205 in file Assembler_Startup.s
Comment: DIV_10 used once
DIV_9 38E38E39

Symbol: DIV_9
   Definitions
      At line 243 in file Assembler_Startup.s
   Uses
      At line 191 in file Assembler_Startup.s
Comment: DIV_9 used once
RAM_Size 00000400

Symbol: RAM_Size
   Definitions
      At line 30 in file Assembler_Startup.s
   Uses
      At line 32 in file Assembler_Startup.s
Comment: RAM_Size used once
4 symbols
366 symbols in table
